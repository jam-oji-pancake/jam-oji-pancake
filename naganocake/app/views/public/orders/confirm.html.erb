<div class="container">
  <div class="row">
    <div class="col-10">
    <h2>注文情報確認</h2>
    <table class="table">
    <thead>
      <tr>
        <th>商品名</th>
        <th>単価</th>
        <th>数量</th>
        <th>小計</th>
        <th></th>
      </tr>
    </thead>
    <tbody>
    <% @sum = 0 %>
    <% @cart_items.each do |carts| %>
      <tr>
        <td>
          <%= attachment_image_tag(carts.item, :image, :fill, 50, 50, fallback: "no_image.jpg") %>
          <%= carts.item.name %>
        </td>
        <td><%= carts.item.add_tax_price.to_s(:delimited) %></td>
        <td><%= carts.count %></td>
        <td><%= (carts.subtotal_price).to_s(:delimited) %></td>
      </tr>
      <% @sum += (carts.subtotal_price).to_i %>
    <% end %>
    </tbody>

    <table class="table">
      <tr><th>送料</th><td><%= @order.send_cost %></td></tr>
      <tr><th>商品小計</th><td><%= @sum.to_s(:delimited)  %></td></tr>
      <tr><th>請求金額</th><td><%= (@order.send_cost + @sum).to_s(:delimited) %></td></tr>
    </table>
<!--@order.perfect_price(@order.send_cost + @sum).to_i-->
    <div>
      <strong>支払い方法</strong>
       <%= @order.payment %>
    </div>

    <div>
    <strong>お届け先</strong>
     <%= @order.post_code %>
     <%= @order.address %>
     <%= @order.name %>
    </div>

    <%= form_with model:@order, url: orders_path, local:true do |f| %>
    <%= f.hidden_field :order_status, value: '入金待ち', required: true %>
    <%= f.hidden_field :perfect_price, value: @order.send_cost + @sum %>
    <%= f.hidden_field :send_cost, value: @order.send_cost %>
    <%= f.hidden_field :payment, value: @order.payment %>
  	<%= f.hidden_field :post_code, value: @order.post_code %>
  	<%= f.hidden_field :address, value: @order.address %>
  	<%= f.hidden_field :name, value: @order.name %>
    <%= f.submit '注文を確定する'%>
    <% end %>
    </div>
  </div>
</div>